<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Irish Property Price Predictor</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="model.js"></script>
</head>
<body class="bg-gradient-to-br from-emerald-50 to-teal-100 min-h-screen py-8 px-4">
    <div class="max-w-2xl mx-auto">
        <div class="bg-white rounded-2xl shadow-2xl p-8">
            <div class="text-center mb-8">
                <h1 class="text-4xl font-bold text-emerald-800 mb-2">üè° Irish Property Price Predictor</h1>
                <p class="text-gray-600">Guess residential property sale prices in Ireland</p>
            </div>

            <form id="predictForm" class="space-y-6">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div>
                        <label for="eircode" class="block text-sm font-semibold text-gray-700 mb-2">
                            First 3 characters of Eircode
                        </label>
                        <input
                            type="text"
                            id="eircode"
                            name="eircode_routing_key"
                            maxlength="3"
                            pattern="[A-Za-z0-9]{3}"
                            placeholder="e.g., D02"
                            value="D08"
                            class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-emerald-500 focus:border-transparent transition uppercase"
                            required
                        >
                    </div>

                    <div>
                        <label for="sale_date" class="block text-sm font-semibold text-gray-700 mb-2">
                            Sale Date
                        </label>
                        <input
                            type="date"
                            id="sale_date"
                            name="sale_date"
                            class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-emerald-500 focus:border-transparent transition"
                            required
                        >
                    </div>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div>
                        <label for="bedrooms" class="block text-sm font-semibold text-gray-700 mb-2">
                            Bedrooms
                        </label>
                        <input
                            type="number"
                            id="bedrooms"
                            name="bedrooms"
                            min="1"
                            max="20"
                            placeholder="e.g., 3"
                            value="3"
                            class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-emerald-500 focus:border-transparent transition"
                            required
                        >
                    </div>

                    <div>
                        <label for="bathrooms" class="block text-sm font-semibold text-gray-700 mb-2">
                            Bathrooms
                        </label>
                        <input
                            type="number"
                            id="bathrooms"
                            name="bathrooms"
                            min="1"
                            max="10"
                            placeholder="e.g., 2"
                            value="2"
                            class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-emerald-500 focus:border-transparent transition"
                            required
                        >
                    </div>
                </div>

                <div>
                    <label for="size_m" class="block text-sm font-semibold text-gray-700 mb-2">
                        Size (square metres)
                    </label>
                    <input
                        type="number"
                        id="size_m"
                        name="size_m"
                        min="10"
                        max="10000"
                        step="0.1"
                        placeholder="e.g., 120"
                        value="85"
                        class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-emerald-500 focus:border-transparent transition"
                        required
                    >
                </div>

                <div>
                    <label for="building_type" class="block text-sm font-semibold text-gray-700 mb-2">
                        Building Type
                    </label>
                    <select
                        id="building_type"
                        name="building_type"
                        class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-emerald-500 focus:border-transparent transition bg-white"
                        required
                    >
                        <option value="">Select building type...</option>
                        <option value="apartment">Apartment</option>
                        <option value="terraced" selected>Terraced</option>
                        <option value="semi_detached">Semi-Detached</option>
                        <option value="detached">Detached</option>
                    </select>
                </div>

                <div>
                    <label for="ber_rating" class="block text-sm font-semibold text-gray-700 mb-2">
                        BER Rating
                    </label>
                    <select
                        id="ber_rating"
                        name="ber_rating"
                        class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-emerald-500 focus:border-transparent transition bg-white"
                        required
                    >
                        <option value="">Select BER rating...</option>
                        <option value="A1">A1 (Best)</option>
                        <option value="A2">A2</option>
                        <option value="A3">A3</option>
                        <option value="B1">B1</option>
                        <option value="B2">B2</option>
                        <option value="B3">B3</option>
                        <option value="C1" selected>C1</option>
                        <option value="C2">C2</option>
                        <option value="C3">C3</option>
                        <option value="D1">D1</option>
                        <option value="D2">D2</option>
                        <option value="E1">E1</option>
                        <option value="E2">E2</option>
                        <option value="F">F</option>
                        <option value="G">G (Worst)</option>
                    </select>
                </div>

                <button
                    type="submit"
                    class="w-full bg-gradient-to-r from-emerald-600 to-teal-600 text-white font-bold py-4 px-6 rounded-lg hover:from-emerald-700 hover:to-teal-700 transform transition hover:scale-105 shadow-lg"
                >
                    Predict Sale Price
                </button>
            </form>

            <div id="result" class="mt-8 hidden">
                <div class="bg-gradient-to-r from-emerald-50 to-teal-50 border-l-4 border-emerald-500 p-6 rounded-lg">
                    <h2 class="text-xl font-bold text-emerald-800 mb-2">Estimated Sale Price</h2>
                    <p class="text-4xl font-bold text-emerald-600" id="predictedPrice">‚Ç¨0</p>
                    <p class="text-sm text-gray-600 mt-2">This is an estimate based on historical data and market trends</p>
                </div>
            </div>

            <div id="error" class="mt-8 hidden">
                <div class="bg-red-50 border-l-4 border-red-500 p-6 rounded-lg">
                    <h2 class="text-xl font-bold text-red-800 mb-2">Error</h2>
                    <p class="text-red-600" id="errorMessage"></p>
                </div>
            </div>
        </div>

        <div class="mt-6 text-center text-gray-600 text-sm">
            <p>Powered by XGBoost machine learning model running entirely in your browser</p>
            <p class="mt-1">No data is sent to any server - completely private</p>
        </div>
    </div>

    <script>
        const form = document.getElementById('predictForm');
        const resultDiv = document.getElementById('result');
        const errorDiv = document.getElementById('error');
        const predictedPriceEl = document.getElementById('predictedPrice');
        const errorMessageEl = document.getElementById('errorMessage');

        function encodeSaleDate(dateString) {
            const baseDate = new Date('2021-01-01');
            const saleDate = new Date(dateString);
            const diffTime = saleDate - baseDate;
            const diffMonths = diffTime / (1000 * 60 * 60 * 24 * 30.44);
            return Math.round(diffMonths);
        }

        function getISOWeek(date) {
            const d = new Date(date);
            d.setHours(0, 0, 0, 0);
            d.setDate(d.getDate() + 4 - (d.getDay() || 7));
            const yearStart = new Date(d.getFullYear(), 0, 1);
            const weekNo = Math.ceil((((d - yearStart) / 86400000) + 1) / 7);
            return weekNo;
        }

        function circleEncodeRatio(value) {
            const angle = 2 * Math.PI * value;
            return [Math.sin(angle), Math.cos(angle)];
        }

        function circleEncodeWeek(dateString) {
            const date = new Date(dateString);
            const week = getISOWeek(date);
            const ratio = (week - 1) / 52;
            return circleEncodeRatio(ratio);
        }

        function formatPrice(price) {
            return new Intl.NumberFormat('en-IE', {
                style: 'currency',
                currency: 'EUR',
                minimumFractionDigits: 0,
                maximumFractionDigits: 0
            }).format(price);
        }

        form.addEventListener('submit', async (e) => {
            e.preventDefault();

            resultDiv.classList.add('hidden');
            errorDiv.classList.add('hidden');

            const formData = new FormData(form);
            const eircode = formData.get('eircode_routing_key').toUpperCase();
            const bedrooms = parseInt(formData.get('bedrooms'));
            const bathrooms = parseInt(formData.get('bathrooms'));
            const size_m = parseFloat(formData.get('size_m'));
            const building_type = formData.get('building_type');
            const ber_rating = formData.get('ber_rating');
            const sale_date_raw = formData.get('sale_date');
            const sale_date_encoded = encodeSaleDate(sale_date_raw);
            const [week_sin, week_cos] = circleEncodeWeek(sale_date_raw);

            const features = [
                eircode,
                bedrooms,
                bathrooms,
                size_m,
                building_type,
                ber_rating,
                sale_date_encoded,
                week_sin,
                week_cos
            ];

            try {
                const prediction = score(features);
                predictedPriceEl.textContent = formatPrice(prediction);
                resultDiv.classList.remove('hidden');
            } catch (error) {
                errorMessageEl.textContent = error.message;
                errorDiv.classList.remove('hidden');
            }
        });

        const today = new Date().toISOString().split('T')[0];
        document.getElementById('sale_date').value = today;
    </script>
</body>
</html>
